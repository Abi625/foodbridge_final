<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login - FoodBridge</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="lavender-bg">

<section class="login-page">
  <div class="login-box">
    <p class="login-pill" id="rolePill">Secure login</p>
    <h2 id="title">Login</h2>
    <p id="subtitle" class="login-subtitle"></p>

    <label class="field-label" for="email">Email address</label>
    <input id="email" type="email" placeholder="yourname@mail.com" required>

    <label class="field-label" for="password">Password</label>
    <input id="password" type="password" placeholder="Enter password" required>

    <div id="otpGroup" class="otp-group hidden">
      <label class="field-label" for="otp">One-time passcode</label>
      <input id="otp" type="text" maxlength="6" placeholder="Enter 6-digit OTP">
      <small class="otp-hint">Demo OTP for receivers: <strong>246810</strong></small>
    </div>

    <button class="login-btn" id="loginBtn">Continue</button>
  </div>
</section>

<script>
  const params = new URLSearchParams(window.location.search);
  const role = params.get("role") === "receiver" ? "receiver" : "donor";
  const title = document.getElementById("title");
  const subtitle = document.getElementById("subtitle");
  const rolePill = document.getElementById("rolePill");
  const otpGroup = document.getElementById("otpGroup");
  const loginBtn = document.getElementById("loginBtn");
  const RECEIVER_LOGIN_OTP = "246810";

  if (role === "donor") {
    title.innerText = "Donor sign in";
    subtitle.innerText = "Post surplus meals with a single alert.";
    rolePill.innerText = "Donor portal";
  } else {
    title.innerText = "Receiver sign in";
    subtitle.innerText = "Get instant notifications and confirm via OTP.";
    rolePill.innerText = "Receiver portal";
    otpGroup.classList.remove("hidden");
  }

  loginBtn.addEventListener("click", () => {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const otp = document.getElementById("otp")?.value.trim();

    if (!email || !password) {
      alert("Please enter both email and password.");
      return;
    }

    if (role === "receiver") {
      if (!otp) {
        alert("Please enter the OTP sent to your device.");
        return;
      }

      if (otp !== RECEIVER_LOGIN_OTP) {
        alert("Invalid OTP. Use the demo code 246810.");
        return;
      }

      sessionStorage.setItem("receiverEmail", email);
      sessionStorage.setItem("receiverName", email.split("@")[0]);
      sessionStorage.setItem("receiverOtpValidated", "true");
      window.location.href = "receiver_view.html";
    } else {
      sessionStorage.setItem("donorEmail", email);
      sessionStorage.setItem("donorName", email.split("@")[0]);
      window.location.href = "donor_post.html";
    }
  });
</script>

</body>
</html>
